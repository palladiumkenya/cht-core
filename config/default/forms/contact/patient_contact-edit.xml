<?xml version="1.0"?>
<h:html xmlns="http://www.w3.org/2002/xforms" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:h="http://www.w3.org/1999/xhtml" xmlns:jr="http://openrosa.org/javarosa" xmlns:orx="http://openrosa.org/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
  <h:head>
    <h:title>Edit Contact</h:title>
    <model>
      <itext>
        <translation lang="en">
          <text id="/data/person/age_months:jr:constraintMsg">
            <value>Months must between 0 and 11</value>
          </text>
          <text id="/data/person/age_years:jr:constraintMsg">
            <value>Age must be between 0 and 130</value>
          </text>
          <text id="/data/person/booking_date:jr:constraintMsg">
            <value>Booking date cannot be in the past</value>
          </text>
          <text id="/data/person/date_of_birth:jr:constraintMsg">
            <value>Date cannot be in the future.</value>
          </text>
          <text id="/data/person/dob_calendar:jr:constraintMsg">
            <value>Date must be before today</value>
          </text>
          <text id="/data/person/f_name:jr:constraintMsg">
            <value>Accepts only alphabets with the first letter capitalized</value>
          </text>
          <text id="/data/person/o_name:jr:constraintMsg">
            <value>Accepts only alphabets with the first letter capitalized</value>
          </text>
          <text id="/data/person/phone:jr:constraintMsg">
            <value>Please enter a valid local number, or use the standard international format, which includes a plus sign (+) and country code. For example: +254712345678</value>
          </text>
          <text id="/data/person/s_name:jr:constraintMsg">
            <value>Accepts only alphabets with the first letter capitalized</value>
          </text>
        </translation>
      </itext>
      <instance>
        <data delimiter="#" id="contact:person:edit" prefix="J1!contact:person:edit!" version="2020-09-01 12:09:47">
          <inputs>
            <meta>
              <location>
                <lat/>
                <long/>
                <error/>
                <message/>
              </location>
            </meta>
            <user>
              <contact_id/>
              <facility_id/>
              <name/>
            </user>
          </inputs>
          <person>
            <type>contact</type>
            <contact_type>person</contact_type>
            <parent>PARENT</parent>
            <role>person</role>
            <record_originator>cht</record_originator>
            <n_demographics/>
            <s_name/>
            <f_name/>
            <o_name/>
            <name/>
            <patient_name/>
            <sex/>
            <dob_known/>
            <dob_calendar/>
            <age_years/>
            <age_months/>
            <ephemeral_months/>
            <ephemeral_years/>
            <dob_approx/>
            <dob_raw/>
            <dob_iso/>
            <dob_debug/>
            <age_in_years/>
            <age_in_months/>
            <date_of_birth/>
            <head_of_household/>
            <marital_status/>
            <demographics_delimiter/>
            <n_address/>
            <physical_address/>
            <phone/>
            <address_delimiter/>
            <n_relationship_details/>
            <contact_relationship/>
            <living_with_client/>
            <relationship_delimiter/>
            <ipv_questions/>
            <ipv_physical/>
            <ipv_threats/>
            <ipv_sexual/>
            <ipv_outcome/>
            <ipv_delimiter/>
            <basline_info/>
            <baseline_hiv_status/>
            <booking_date/>
            <pns_approach/>
            <baseline_delimiter/>
            <meta tag="hidden">
              <created_by/>
              <created_by_person_uuid/>
              <created_by_place_uuid/>
            </meta>
          </person>
          <meta tag="hidden">
            <instanceID/>
          </meta>
        </data>
      </instance>
      <bind nodeset="/data/inputs" relevant="0"/>
      <bind nodeset="/data/inputs/user/contact_id" type="string"/>
      <bind nodeset="/data/inputs/user/facility_id" type="string"/>
      <bind nodeset="/data/inputs/user/name" type="string"/>
      <bind nodeset="/data/person/type" type="string"/>
      <bind nodeset="/data/person/contact_type" type="string"/>
      <bind nodeset="/data/person/parent" type="string"/>
      <bind nodeset="/data/person/role" type="string"/>
      <bind nodeset="/data/person/record_originator" type="string"/>
      <bind nodeset="/data/person/n_demographics" readonly="true()" type="string"/>
      <bind constraint="regex(., '^[A-Z]{1}[a-z]{1,14}$')" jr:constraintMsg="jr:itext('/data/person/s_name:jr:constraintMsg')" nodeset="/data/person/s_name" required="true()" type="string"/>
      <bind constraint="regex(., '^[A-Z]{1}[a-z]{1,14}$')" jr:constraintMsg="jr:itext('/data/person/f_name:jr:constraintMsg')" nodeset="/data/person/f_name" required="true()" type="string"/>
      <bind constraint="regex(., '^[A-Z]{1}[a-z]{1,14}$')" jr:constraintMsg="jr:itext('/data/person/o_name:jr:constraintMsg')" nodeset="/data/person/o_name" type="string"/>
      <bind calculate="concat( /data/person/f_name , ' ',  /data/person/o_name , ' ',  /data/person/s_name )" nodeset="/data/person/name" type="string"/>
      <bind calculate="../name" nodeset="/data/person/patient_name" type="string"/>
      <bind nodeset="/data/person/sex" required="true()" type="select1"/>
      <bind nodeset="/data/person/dob_known" required="true()" type="select1"/>
      <bind constraint="floor(decimal-date-time(.)) &lt;= floor(decimal-date-time(today())) and floor( difference-in-months( . , today() ) div 12 ) &lt;= 100" jr:constraintMsg="jr:itext('/data/person/dob_calendar:jr:constraintMsg')" nodeset="/data/person/dob_calendar" relevant=" /data/person/dob_known  = 'yes'" required="true()" type="date"/>
      <bind constraint=". &gt;= 0 and . &lt;= 100" jr:constraintMsg="jr:itext('/data/person/age_years:jr:constraintMsg')" nodeset="/data/person/age_years" relevant=" /data/person/dob_known  != 'yes'" required="true()" type="int"/>
      <bind constraint=". &gt;= 0 and . &lt;= 11" jr:constraintMsg="jr:itext('/data/person/age_months:jr:constraintMsg')" nodeset="/data/person/age_months" relevant=" /data/person/dob_known  != 'yes'" required="false()" type="int"/>
      <bind calculate="if(format-date-time(today(),&quot;%m&quot;) -  /data/person/age_months  &lt; 0, format-date-time(today(),&quot;%m&quot;) -  /data/person/age_months  + 12, format-date-time(today(),&quot;%m&quot;) -  /data/person/age_months )" nodeset="/data/person/ephemeral_months" type="string"/>
      <bind calculate="if(format-date-time(today(),&quot;%m&quot;) -  /data/person/age_months  &lt; 0, format-date-time(today(),&quot;%Y&quot;) -  /data/person/age_years  - 1, format-date-time(today(),&quot;%Y&quot;) -  /data/person/age_years )" nodeset="/data/person/ephemeral_years" type="string"/>
      <bind calculate="date(concat(string( /data/person/ephemeral_years ),'-',if( /data/person/ephemeral_months &lt;10, concat('0',string( /data/person/ephemeral_months )),  /data/person/ephemeral_months ),'-',string(format-date-time(today(), &quot;%d&quot;))))" nodeset="/data/person/dob_approx" type="string"/>
      <bind calculate="if( /data/person/dob_known  = 'yes',  /data/person/dob_calendar , /data/person/dob_approx )" nodeset="/data/person/dob_raw" type="string"/>
      <bind calculate="format-date-time(decimal-date-time(../dob_raw),&quot;%Y-%m-%d&quot;)" nodeset="/data/person/dob_iso" type="string"/>
      <bind nodeset="/data/person/dob_debug" readonly="true()" relevant="0" type="string"/>
      <bind calculate="floor( difference-in-months(  /data/person/date_of_birth , today() ) div 12 )" nodeset="/data/person/age_in_years" type="string"/>
      <bind calculate="difference-in-months(  /data/person/date_of_birth , today() )" nodeset="/data/person/age_in_months" type="string"/>
      <bind calculate=" /data/person/dob_iso " constraint=". &lt; today()" jr:constraintMsg="jr:itext('/data/person/date_of_birth:jr:constraintMsg')" nodeset="/data/person/date_of_birth" type="string"/>
      <bind nodeset="/data/person/head_of_household" type="string"/>
      <bind nodeset="/data/person/marital_status" type="select1"/>
      <bind nodeset="/data/person/demographics_delimiter" readonly="true()" type="string"/>
      <bind nodeset="/data/person/n_address" readonly="true()" type="string"/>
      <bind nodeset="/data/person/physical_address" required="false()" type="string"/>
      <bind constraint="regex(.,'(\+?\d{1,3})(\d{2,4})(\d{5,6})') and string-length(.) &lt;=14" jr:constraintMsg="jr:itext('/data/person/phone:jr:constraintMsg')" nodeset="/data/person/phone" required="true()" type="string"/>
      <bind nodeset="/data/person/address_delimiter" readonly="true()" type="string"/>
      <bind nodeset="/data/person/n_relationship_details" readonly="true()" type="string"/>
      <bind nodeset="/data/person/contact_relationship" required="false()" type="select1"/>
      <bind nodeset="/data/person/living_with_client" required="false()" type="select1"/>
      <bind nodeset="/data/person/relationship_delimiter" readonly="true()" type="string"/>
      <bind nodeset="/data/person/ipv_questions" readonly="true()" type="string"/>
      <bind nodeset="/data/person/ipv_physical" required="true()" type="select1"/>
      <bind nodeset="/data/person/ipv_threats" required="true()" type="select1"/>
      <bind nodeset="/data/person/ipv_sexual" required="true()" type="select1"/>
      <bind nodeset="/data/person/ipv_outcome" required="true()" type="select1"/>
      <bind nodeset="/data/person/ipv_delimiter" readonly="true()" type="string"/>
      <bind nodeset="/data/person/basline_info" readonly="true()" type="string"/>
      <bind nodeset="/data/person/baseline_hiv_status" required="true()" type="select1"/>
      <bind constraint=". &gt;= today()" jr:constraintMsg="jr:itext('/data/person/booking_date:jr:constraintMsg')" nodeset="/data/person/booking_date" type="date"/>
      <bind nodeset="/data/person/pns_approach" type="select1"/>
      <bind nodeset="/data/person/baseline_delimiter" readonly="true()" type="string"/>
      <bind calculate="../../../inputs/user/name" nodeset="/data/person/meta/created_by" type="string"/>
      <bind calculate="../../../inputs/user/contact_id" nodeset="/data/person/meta/created_by_person_uuid" type="string"/>
      <bind calculate="../../../inputs/user/facility_id" nodeset="/data/person/meta/created_by_place_uuid" type="string"/>
      <bind calculate="concat('uuid:', uuid())" nodeset="/data/meta/instanceID" readonly="true()" type="string"/>
    </model>
  </h:head>
  <h:body class="pages">
    <group ref="/data/inputs">
      <label></label>
      <group ref="/data/inputs/user">
        <label></label>
        <input ref="/data/inputs/user/contact_id">
          <label></label>
        </input>
        <input ref="/data/inputs/user/facility_id">
          <label></label>
        </input>
        <input ref="/data/inputs/user/name">
          <label></label>
        </input>
      </group>
    </group>
    <group appearance="field-list" ref="/data/person">
      <label>Registration Details</label>
      <input ref="/data/person/n_demographics">
        <label>**&lt;span style="color:blue"&gt;Demographics&lt;/span&gt;**</label>
      </input>
      <input ref="/data/person/s_name">
        <label>Surname</label>
      </input>
      <input ref="/data/person/f_name">
        <label>First name</label>
      </input>
      <input ref="/data/person/o_name">
        <label>Other name(s)</label>
      </input>
      <select1 ref="/data/person/sex">
        <label>Sex</label>
        <item>
          <label>Male</label>
          <value>male</value>
        </item>
        <item>
          <label>Female</label>
          <value>female</value>
        </item>
      </select1>
      <select1 ref="/data/person/dob_known">
        <label>Does <output value=" /data/person/patient_name "/> know their date of birth?</label>
        <item>
          <label>Yes</label>
          <value>yes</value>
        </item>
        <item>
          <label>No</label>
          <value>no</value>
        </item>
      </select1>
      <input ref="/data/person/dob_calendar">
        <label>Date of Birth</label>
      </input>
      <input ref="/data/person/age_years">
        <label>Age (years)</label>
      </input>
      <input ref="/data/person/age_months">
        <label>Age (months)</label>
      </input>
      <input ref="/data/person/dob_debug">
        <label>Months: <output value=" /data/person/ephemeral_months "/> Year: <output value=" /data/person/ephemeral_years "/> DOB Approx: <output value=" /data/person/dob_approx "/> DOB Calendar: <output value=" /data/person/dob_calendar "/> DOB ISO: <output value=" /data/person/dob_iso "/> AGE Years: <output value=" /data/person/age_in_years "/></label></input>
      <select1 appearance="minimal" ref="/data/person/marital_status">
        <label>Marital Status</label>
        <item>
          <label>Married polygamous</label>
          <value>married_polygamous</value>
        </item>
        <item>
          <label>Married monogamous</label>
          <value>married_monogamous</value>
        </item>
        <item>
          <label>Divorced</label>
          <value>divorced</value>
        </item>
        <item>
          <label>Widowed</label>
          <value>widowed</value>
        </item>
        <item>
          <label>Cohabiting</label>
          <value>cohabiting</value>
        </item>
        <item>
          <label>Single</label>
          <value>single</value>
        </item>
      </select1>
      <input ref="/data/person/demographics_delimiter">
        <label>&lt;hr style="margin:0 auto;"&gt;</label>
      </input>
      <input ref="/data/person/n_address">
        <label>**&lt;span style="color:blue"&gt;Address&lt;/span&gt;**</label>
      </input>
      <input ref="/data/person/physical_address">
        <label>Physical Address/Landmark</label>
      </input>
      <input ref="/data/person/phone">
        <label>Phone No.</label>
        <hint>Please enter a valid local number, or use the standard international format, which includes a plus sign (+) and country code. For example: +254712345678</hint>
      </input>
      <input ref="/data/person/address_delimiter">
        <label>&lt;hr style="margin:0 auto;"&gt;</label>
      </input>
      <input ref="/data/person/n_relationship_details">
        <label>**&lt;span style="color:blue"&gt;Relationship to Patient&lt;/span&gt;**</label>
      </input>
      <select1 appearance="minimal" ref="/data/person/contact_relationship">
        <label>Relationship to patient</label>
        <item>
          <label>Partner</label>
          <value>partner</value>
        </item>
        <item>
          <label>Spouse</label>
          <value>spouse</value>
        </item>
        <item>
          <label>Father</label>
          <value>father</value>
        </item>
        <item>
          <label>Mother</label>
          <value>mother</value>
        </item>
        <item>
          <label>Sibling</label>
          <value>sibling</value>
        </item>
        <item>
          <label>Child</label>
          <value>child</value>
        </item>
        <item>
          <label>Guardian</label>
          <value>guardian</value>
        </item>
      </select1>
      <select1 appearance="minimal" ref="/data/person/living_with_client">
        <label>Living with client</label>
        <item>
          <label>Yes</label>
          <value>yes</value>
        </item>
        <item>
          <label>No</label>
          <value>no</value>
        </item>
        <item>
          <label>Declined to answer</label>
          <value>na</value>
        </item>
      </select1>
      <input ref="/data/person/relationship_delimiter">
        <label>&lt;hr style="margin:0 auto;"&gt;</label>
      </input>
      <input ref="/data/person/ipv_questions">
        <label>**&lt;span style="color:blue"&gt;IPV Questions&lt;/span&gt;**</label>
      </input>
      <select1 ref="/data/person/ipv_physical">
        <label>Has he/she ever hit, kicked, slapped, or otherwise physically hurt you?</label>
        <item>
          <label>Yes</label>
          <value>yes</value>
        </item>
        <item>
          <label>No</label>
          <value>no</value>
        </item>
      </select1>
      <select1 ref="/data/person/ipv_threats">
        <label>Has he/she ever threatened to hurt you?</label>
        <item>
          <label>Yes</label>
          <value>yes</value>
        </item>
        <item>
          <label>No</label>
          <value>no</value>
        </item>
      </select1>
      <select1 ref="/data/person/ipv_sexual">
        <label>Has he/she ever forced you to do something sexually that made you feel uncomfortable?</label>
        <item>
          <label>Yes</label>
          <value>yes</value>
        </item>
        <item>
          <label>No</label>
          <value>no</value>
        </item>
      </select1>
      <select1 ref="/data/person/ipv_outcome">
        <label>IPV outcome</label>
        <item>
          <label>1</label>
          <value>1</value>
        </item>
        <item>
          <label>0</label>
          <value>0</value>
        </item>
      </select1>
      <input ref="/data/person/ipv_delimiter">
        <label>&lt;hr style="margin:0 auto;"&gt;</label>
      </input>
      <input ref="/data/person/basline_info">
        <label>**&lt;span style="color:blue"&gt;Baseline information&lt;/span&gt;**</label>
      </input>
      <select1 ref="/data/person/baseline_hiv_status">
        <label>HIV status</label>
        <item>
          <label>Unknown</label>
          <value>unknown</value>
        </item>
        <item>
          <label>Positive</label>
          <value>positive</value>
        </item>
        <item>
          <label>Negative</label>
          <value>negative</value>
        </item>
        <item>
          <label>Exposed Infant</label>
          <value>exposed_infant</value>
        </item>
      </select1>
      <input ref="/data/person/booking_date">
        <label>Booking Date</label>
      </input>
      <select1 ref="/data/person/pns_approach">
        <label>Preferred PNS Approach</label>
        <item>
          <label>Dual Referral</label>
          <value>dual_referral</value>
        </item>
        <item>
          <label>Provider Referral</label>
          <value>provider_referral</value>
        </item>
        <item>
          <label>Passive Referral</label>
          <value>passive_referral</value>
        </item>
        <item>
          <label>Contact Referral</label>
          <value>contract_referral</value>
        </item>
      </select1>
      <input ref="/data/person/baseline_delimiter">
        <label>&lt;hr style="margin:0 auto;"&gt;</label>
      </input>
      <group appearance="hidden" ref="/data/person/meta">
        <label></label>
      </group>
    </group>
  </h:body>
</h:html>
